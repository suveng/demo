# 6-0 MySQL-shardingsphere分库分表

[Apache ShardingSphere 官网](https://shardingsphere.apache.org/)

## 读写分离

## 分库分表

优点: 

- 单表分库分表
- 读写分离
- 数据库的分布式事务

缺点: 

- 连表查询
- 分页查询 归并引擎



### 数据分片

键值方案: 

- 以单一字段做分片键 id
- 设计id的存储位, 版本+时间+唯一id
- 版本位 作为分片算法的id, 找出对应的bean



数据源动态配置

使用加权的一致性hash算法;

一致性hash使用guava类库 hashing 提供的

加权自己实现, 加权的配置存储到数据库中. 每个版本都有独立的配置, 可更改



### 注意点

1. 读写分离

- 没有事务时, 根据SQL去做读写分离

- 有事务时, 一旦线程内使用了主库, 后续线程内的读写都是使用主库, 但是异步线程后就没有了这个限制了? 

  - 怀疑: 和事务隔离级别有关系

  

## 分布式事务



### seata事务配置

